// 修复 stdio-mcp-client.js 的编码问题
const fs = require('fs');
const filePath = 'e:\\MultiModel\\ai-adhd-website\\api-server\\src\\stdio-mcp-client.js';

// 读取文件
let content = fs.readFileSync(filePath, 'utf8');

// 修复中文乱码 - 使用正则表达式替换
const fixes = {
    // 降级相关
    '馃搲 闄嶇骇鍒?': '🔴 降级到',
    '鏈€灏忓姛鑳芥ā寮?': '最小功能模式',
    '鈿狅笍 宸茶揪鍒版渶浣庨檷绾х骇鍒?': '💔 已达到最低降级级别',
    '绂荤嚎妯″紡': '离线模式',
    '馃搱 鍗囩骇鍒?': '🟡 升级到',
    '馃攧 浣跨敤绠€鍖栧姛鑳芥ā寮?': '🟢 使用简化功能模式',
    
    // 状态消息
    '鎵€鏈夊姛鑳芥甯歌繍琛?': '所有功能正常运行',
    '閮ㄥ垎鍔熻兘宸蹭紭鍖栵紝鎬ц兘鎻愬崌涓?': '部分功能已优化，性能提升中',
    '鏍稿績鍔熻兘姝ｅ父杩愯锛岄儴鍒嗗姛鑳芥殏鏃朵笉鍙敤': '核心功能正常运行，部分功能暂时不可用',
    '绂荤嚎妯″紡锛屼娇鐢ㄧ紦瀛樻暟鎹?': '离线模式，使用缓存数据',
    
    // 错误消息
    '鏈嶅姟鏆傛椂涓嶅彲鐢紝璇风◢鍚庨噸璇?': '服务暂时不可用，请稍后重试',
    '鏃犳硶杩炴帴鍒版湇鍔?': '无法连接到服务',
    '鏈嶅姟鏆傛椂涓嶅彲鐢?': '服务暂时不可用',
    
    // 建议
    '妫€鏌ョ綉缁滆繛鎺?': '检查网络连接',
    '纭鏈嶅姟姝ｅ湪杩愯': '确认服务正在运行',
    '妫€鏌ョ綉缁滃欢杩?': '检查网络延迟',
    '鍑忓皯璇锋眰澶嶆潅搴?': '减少请求复杂度',
    '绋嶅悗閲嶈瘯': '稍后重试',
    '妫€鏌ュ嚟鎹槸鍚︽纭?': '检查凭证是否正确',
    '閲嶆柊鐧诲綍': '重新登录',
    '鑱旂郴绠＄悊鍛?': '联系管理员',
    '绛夊緟鍚庨噸璇?': '等待后重试',
    '妫€鏌ユ湇鍔＄姸鎬?': '检查服务状态',
    '鑱旂郴鎶€鏈敮鎸?': '联系技术支持',
    
    // 其他
    '绂荤嚎妯″紡鏃犳硶澶勭悊璇锋眰': '离线模式无法处理请求',
    '閫氳繃stdio涓嶮CP鏈嶅姟閫氫俊鐨勫鎴风': '通过stdio与MCP服务通信的客户端',
    '鏀寔spawn瀛愯繘绋嬨€乻endRequest銆乺eceiveResponse銆佽秴鏃跺鐞嗐€侀敊璇棩蹇?': '支持spawn子进程、sendRequest、receiveResponse、超时处理、错误日志',
    '鏅鸿兘闄嶇骇閰嶇疆': '智能降级配置',
    '瀹屾暣鍔熻兘': '完整功能',
    '鍑忓皯鍔熻兘': '减少功能',
    '鏈€灏忓姛鑳?': '最小功能',
    '绂荤嚎妯″紡': '离线模式',
    '閿欒鐜囬槇鍊?': '错误率阈值',
    '鍝嶅簲鏃堕棿闃堝€?': '响应时间阈值',
    '杩炵画澶辫触闃堝€?': '连续失败阈值',
    '鎬ц兘鐩戞帶': '性能监控'
};

// 应用所有修复
for (const [wrong, correct] of Object.entries(fixes)) {
    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
    content = content.replace(regex, correct);
}

// 写入修复后的文件
fs.writeFileSync(filePath, content, 'utf8');
console.log('UTF-8 encoding issues fixed');